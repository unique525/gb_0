<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
    <link type="text/css" href="/system_template/default/images/jquery_ui/jquery-ui.min.css" rel="stylesheet" />
    <style type="text/css">
        .ok1{background:url(/system_design/ok.gif) no-repeat 160px;}
        .error1{background:url(/system_design/error.gif) no-repeat 160px;}
        .error_span{color:#990000;font-weight: bold;padding-left:25px;font-size:12px}
    </style>
    <script type="text/javascript" src="/system_js/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="/system_js/common.js"></script>
    <script type="text/javascript" src="/system_js/jquery_ui/jquery-ui-1.8.2.custom.min.js"></script>
    <script type="text/javascript">
        var canSubmit = true;

        function subForm(){
            if ($("#user_email").val() == "") {
                $("#result_table").html("请输入邮箱");
                $("#dialog_result_box").dialog("destroy");
                $("#dialog_result_box").dialog({
                    buttons: {
                        Ok: function () {
                            $(this).dialog("close");
                        }
                    }
                });
            } else if ($("#user_pass").val() == "") {
                $("#result_table").html("请输入密码");
                $("#dialog_result_box").dialog("destroy");
                $("#dialog_result_box").dialog({
                    buttons: {
                        Ok: function () {
                            $(this).dialog("close");
                        }
                    }
                });
            }  else if ($("#confirm_pass").val() == "") {
                $("#result_table").html("请确认密码");
                $("#dialog_result_box").dialog("destroy");
                $("#dialog_result_box").dialog({
                    buttons: {
                        Ok: function () {
                            $(this).dialog("close");
                        }
                    }
                });
            }else if ($("#check_code").val() == "") {
                $("#result_table").html("请输入验证码");
                $("#dialog_result_box").dialog("destroy");
                $("#dialog_result_box").dialog({
                    buttons: {
                        Ok: function () {
                            $(this).dialog("close");
                        }
                    }
                });
            } else if (!$("#accept_item").prop('checked')) {
                $("#result_table").html("您未接受服务条款");
                $("#dialog_result_box").dialog("destroy");
                $("#dialog_result_box").dialog({
                    buttons: {
                        Ok: function () {
                            $(this).dialog("close");
                        }
                    }
                });
            } else {
                if (canSubmit) {
                    $("#btnsubmit").attr("disabled",true);
                    var param = $("#main_form").serialize();
                    var url = "/default.php?mod=user&a=register&site_id=1";
                    $.ajax({
                        url: url,
                        type:"post",
                        data:param,
                        dataType: "jsonp",
                        jsonp: "jsonpcallback",
                        success: function (data) {
                            var result = data["result"];
                            if(result == -1){
                                $("#result_table").html("这个用户账号已经被注册了！");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else if(result == -6){
                                $("#result_table").html("格式不正确！");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else if(result == -2){
                                $("#result_table").html("这个邮箱已经被注册了！");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else if(result == -3){
                                $("#result_table").html("这个号码已经被注册了！");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else if(result == -4){
                                $("#result_table").html("参数不正确！");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else if(result == -5){
                                $("#result_table").html("注册失败！");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else if(result == 1){
                                $("#result_table").html("注册成功！");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else{
                                $("#result_table").html("注册失败，未知错误，请联系管理员！");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }
                        }
                    });
                }
            }
            return false;
        }
        $(function(){
            var btnSubmit = $("#btn_sub");
            btnSubmit.click(function() {
                subForm();
            });

            $("#user_email").blur(function(){
                var user_email = $(this).val();
                if(!checkEmail(user_email)){
                    $("#td_user_email").attr("class", "error1");
                    $("#span_user_email_error").text("邮箱格式不正确！");
                    $(this).val("");
                    canSubmit = false;
                }else{
                    var url = "/default.php?mod=user&a=async_check_repeat&site_id=1";
                    $.ajax({
                        url: url,
                        data:{user_email:user_email},
                        dataType: "jsonp",
                        jsonp: "jsonpcallback",
                        success: function (data) {
                            var result = data["result"];
                            if(result == -4){
                                $("#td_user_email").attr("class", "error1");
                                $("#result_table").html("非法参数");
                                $(this).val("");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else  if(result == -1){
                                $("#td_user_email").attr("class", "error1");
                                $("#result_table").html("这个用户账号已经被注册了！");
                                $(this).val("");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else  if(result == -2){
                                $("#td_user_email").attr("class", "error1");
                                $("#result_table").html("这个邮箱已经被注册了！");
                                $(this).val("");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else  if(result == -3){
                                $("#td_user_email").attr("class", "error1");
                                $("#result_table").html("这个号码已经被注册了！");
                                $(this).val("");
                                $("#dialog_result_box").dialog("destroy");
                                $("#dialog_result_box").dialog({
                                    buttons: {
                                        Ok: function () {
                                            $(this).dialog("close");
                                        }
                                    }
                                });
                            }else if(result == 0){
                                $("#td_user_email").attr("class", "ok1");
                                $("#span_user_email_error").text("");
                            }
                        }
                    });
                }
            });

            $("#user_pass").blur(function () {
                var user_pass = $("#user_pass").val();
                if (user_pass.length < 6) {
                    $("#td_user_pass").attr("class", "error1");
                    $("#span_pass_error").text("密码不能少于6位！");
                    canSubmit = false;
                } else {
                    $("#td_user_pass").attr("class", "ok1");
                    $("#span_pass_error").text("");
                }
            });

            $("#confirm_pass").blur(function () {
                var user_pass = $("#user_pass").val();
                var confirm_pass = $("#confirm_pass").val();
                if (confirm_pass.length > 0) {
                    if (confirm_pass != user_pass) {
                        $("#td_confirm_pass").attr("class", "error1");
                        $("#span_confirm_pass_error").text("两次输入的密码不一样！");
                        canSubmit = false;
                    } else {
                        $("#td_confirm_pass").attr("class", "ok1");
                        $("#span_confirm_pass_error").text("");
                    }
                }
            });

            $("#check_code").blur(function(){
                var txtCheckCode = $("#check_code");
                var code = txtCheckCode.val();
                $.post("/default.php?mod=common&a=check_verify_code&sn=user_register&verify_code_type=0&verify_code_value=" + code, {
                    opResult: $(this).html()
                }, function(xml) {
                    var result = parseInt(xml);
                    if (result == -1) {
                        $("#td_check_code").attr("class", "error1");
                        $("#span_check_code_error").text("验证码错误！");
                        canSubmit = false;
                    } else{
                        $("#td_check_code").attr("class", "ok1");
                        $("#span_check_code_error").text("");
                    }
                });
            });
        });
    </script>
</head>
<body>
<div id="dialog_result_box" title="提示信息" style="display: none;">
    <div id="result_table" style="font-size: 14px;">
    </div>
</div>
<form id="main_form">
    <table width="100%" cellpadding="0" cellspacing="0" border="1">
        <tr height="30">
            <td width="80">邮箱：</td>
            <td width="400" id="td_user_email">
                <input type="text" id="user_email" maxlength="40" class="input_box" name="UserEmail" value=""/>
                <span id="span_user_email_error" class="error_span"></span>
            </td>
            <td width="100"><a href="#">手机注册</a></td>
            <td rowspan="7">
                <div style="border:1px #CCC solid;width:200px;height:170px"></div>
            </td>
        </tr>
        <tr height="30">
            <td colspan="3" height="20">
                <span>邮箱长度应在4-40之间</span>
            </td>
        </tr>
        <tr height="30">
            <td>密码：</td>
            <td id="td_user_pass">
                <input type="password" id="user_pass" class="input_box" name="UserPass" value=""/>
                <span id="span_pass_error" class="error_span"></span>
            </td>
            <td></td>
        </tr>
        <tr height="30">
            <td>确认密码：</td>
            <td id="td_confirm_pass">
                <input type="password" id="confirm_pass" class="input_box" value="" />
                <span id="span_confirm_pass_error" class="error_span"></span>
            </td>
            <td></td>
        </tr>
        <tr height="30">
            <td>验证码：</td>
            <td id="td_check_code">
                <input type="text" id="check_code" class="input_number" value="" size="8"/>
                <img src="/default.php?mod=common&a=gen_gif_verify_code&sn=user_register" title="" alt="" onclick="this.setAttribute('src','/default.php?mod=common&a=gen_gif_verify_code&sn=user_register&n='+Math.random());" style="cursor: pointer;" />
                <span class="error_span" id="span_check_code_error"></span>
            </td>
            <td>

            </td>
        </tr>
        <tr height="30">
            <td colspan="3">
                <input type="checkbox" id="accept_item" name="accept_item"/>我已接受星滋味的<a href="#">服务条款</a>
            </td>
        </tr>
        <tr height="30">
            <td colspan="3">
               <input type="button" id="btn_sub" value="确定"/>
            </td>
        </tr>

    </table>
</form>
</body>
</html>