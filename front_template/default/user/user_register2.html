<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>会员注册</title>
<script type="text/javascript" src="{b_funcdomain}/common/js/jquery-1.5.1.min.js"></script>
<script type="text/javascript" src="{b_funcdomain}/common/js/jquery-ui-1.8.17.custom.min.js"></script>
<link href="{b_funcdomain}/common/css/jquery-ui-1.8.17.custom.css" rel="stylesheet" type="text/css" />
<link href="/images_user/user.css" rel="stylesheet" type="text/css" />
<style type="text/css">
    body
    {
        font: 62.5%;
    }
    ul#icons
    {
        margin: 0;
        padding: 0;
    }
    ul#icons li
    {
        margin: 2px;
        position: relative;
        padding: 4px 0;
        cursor: pointer;
        float: left;
        list-style: none;
    }
    ul#icons span.ui-icon
    {
        float: left;
        margin: 0 4px;
    }
</style>
<script type="text/javascript">
var cansubmit = true;
$().ready(function () {
    //email
    $('#email').blur(function () {
        var email = $("#email").val();
        //先检查格式
        if (email.length > 0) {
            if (!isEmail(email)) {
                $("#td_email").attr("class", "error1");
                $("#span_email_error").text("电子邮箱格式不正确！");
                cansubmit = false;
            } else {
                $("#td_email").attr("class", "ok1");
                $("#span_email_error").text("");
                cansubmit = true;
            }
        }
        else {
            $("#td_email").attr("class", "error1");
            $("#span_email_error").text("请输入电子邮箱！");
            cansubmit = false;
        }
    });
    $('#answer').blur(function () {
        var answer = $("#answer").val();
        if (answer.length > 0) {
            cansubmit = true;
        }
        else {
            $("#td_answer").attr("class", "error1");
            $("#span_answer_error").text("请输入问题答案！");
            cansubmit = false;
        }
    });
    //username
    $('#username').blur(function () {
        var username = $("#username").val();
        //先检查格式
        if (username.length > 0) {
            if (!isValidUserName(username)) {
                $("#td_username").attr("class", "error1");
                $("#span_username_error").text("会员帐号格式不正确，会员帐号只能包括中文、字母、数字、下划线！");
                cansubmit = false;
            } else {
                //$("#td_username").attr("class", "ok1");
                //$("#span_username_error").text("");
                cansubmit = true;
            }
        }
        else {
            $("#td_username").attr("class", "error1");
            $("#span_username_error").text("请输入会员帐号！");
            cansubmit = false;
        }
        if (cansubmit) {
            //检查是否被注册
            if (username.length > 1) {
                $.ajax({
                    url: "{b_funcdomain}/index.php?a=user&f=checkusername&siteid={siteid}&username=" + encodeURIComponent(username),
                    dataType: "jsonp",
                    jsonp: "jsonpcallback",
                    success: function (data) {
                        if (data.error != undefined) {
                            $("#resulttable").html(data.error);
                            $("#dialog_resultbox").dialog("destroy");
                            $("#dialog_resultbox").dialog({
                                buttons: {
                                    Ok: function () {
                                        $(this).dialog("close");
                                    }
                                }
                            });
                        } else {
                            var hascount = parseInt(data.hascount);
                            if (hascount > 0) {
                                $("#td_username").attr("class", "error1");
                                $("#span_username_error").text("帐号已经被使用！");
                                cansubmit = false;
                            } else {
                                $("#td_username").attr("class", "ok1");
                                $("#span_username_error").text("");
                                cansubmit = true;
                            }
                        }
                    }
                });
            } else {
                $("#td_username").attr("class", "error1");
                $("#span_username_error").text("帐号不能少于2个字符！");
                cansubmit = false;
            }
        }
    });
    $('#userpass').blur(function () {
        var userpass = $("#userpass").val()
        if (userpass.length < 6) {
            $("#td_userpass").attr("class", "error1");
            $("#span_userpass_error").text("密码不能少于6位！");
            cansubmit = false;
        } else {
            $("#td_userpass").attr("class", "ok1");
            $("#span_userpass_error").text("");
            cansubmit = true;
        }
    });
    $('#confirm_userpass').blur(function () {
        var userpass = $("#userpass").val();
        var confirm_userpass = $("#confirm_userpass").val();
        if (confirm_userpass.length > 0) {
            if (confirm_userpass != userpass) {
                $("#td_confirm_userpass").attr("class", "error1");
                $("#span_confirm_userpass_error").text("两次输入的密码不一样！");
                cansubmit = false;
            } else {
                $("#td_confirm_userpass").attr("class", "ok1");
                $("#span_confirm_userpass_error").text("");
                cansubmit = true;
            }
        }
    });

    $('#nickname').blur(function () {
        var nickname= $("#nickname").val()
        if(nickname.length < 1){
            $("#td_nickname").attr("class", "error1");
            $("#span_nickname_error").text("请填写昵称");
        }
        var result = 1;
        $.ajax({
            url:"{b_funcdomain}/index.php?a=user&f=userinfo&m=checksamenickname&nm="+nickname,
            dataType:"jsonp",
            jsonp:"jsonpcallback",
            success:function(data){
                result = data.result;
                if(result == 0){
                    $("#td_nickname").attr("class", "ok1");
                    $("#span_nickname_error").text("");
                    cansubmit = true;
                }else{
                    $("#td_nickname").attr("class", "error1");
                    $("#span_nickname_error").text("昵称已经被使用");
                    cansubmit = false;
                }

            }
        });
    });

    $('#realname').blur(function () {
        var realname= $("#realname").val()
        if (realname.length > 4) {
            $("#td_realname").attr("class", "error1");
            $("#span_realname_error").text("真实姓名不能多于4字符！");
            cansubmit = false;
        } else {
            $("#td_realname").attr("class", "ok1");
            $("#span_realname_error").text("");
            cansubmit = true;
        }
    });




    $('form').submit(function () {
        if ($('#username').val() == "") {
            $("#resulttable").html("请输入会员名");
            $("#dialog_resultbox").dialog("destroy");
            $("#dialog_resultbox").dialog({
                buttons: {
                    Ok: function () {
                        $(this).dialog("close");
                    }
                }
            });
        } else if ($('#userpass').val() == "") {
            $("#resulttable").html("请输入密码");
            $("#dialog_resultbox").dialog("destroy");
            $("#dialog_resultbox").dialog({
                buttons: {
                    Ok: function () {
                        $(this).dialog("close");
                    }
                }
            });
        } else if ($('#email').val() == "") {
            $("#resulttable").html("请输入电子邮箱");
            $("#dialog_resultbox").dialog("destroy");
            $("#dialog_resultbox").dialog({
                buttons: {
                    Ok: function () {
                        $(this).dialog("close");
                    }
                }
            });
        } else if ($('#answer').val() == "") {
            $("#resulttable").html("请输入问题答案");
            $("#dialog_resultbox").dialog("destroy");
            $("#dialog_resultbox").dialog({
                buttons: {
                    Ok: function () {
                        $(this).dialog("close");
                    }
                }
            });
        } else if ($('#nickname').val() == "") {
            $("#resulttable").html("请输入昵称");
            $("#dialog_resultbox").dialog("destroy");
            $("#dialog_resultbox").dialog({
                buttons: {
                    Ok: function () {
                        $(this).dialog("close");
                    }
                }
            });
        }else if ($('#realname').val() == "") {
            $("#resulttable").html("请输入真实姓名");
            $("#dialog_resultbox").dialog("destroy");
            $("#dialog_resultbox").dialog({
                buttons: {
                    Ok: function () {
                        $(this).dialog("close");
                    }
                }
            });
        }else {
            if (cansubmit) {
                $("#btnsubmit").attr("disabled",true);
                var param = $(this).serialize();
                var url = "{b_funcdomain}/index.php?a=user&f=regjson&" + param;
                $.ajax({
                    url: url,
                    dataType: "jsonp",
                    jsonp: "jsonpcallback",
                    success: function (data) {
                        if (data.error != undefined) {
                            $("#resulttable").html(data.error);
                            $("#dialog_resultbox").dialog("destroy");
                            $("#dialog_resultbox").dialog({
                                buttons: {
                                    Ok: function () {
                                        $(this).dialog("close");
                                    }
                                }
                            });
                        } else {

                            var userid = parseInt(data.UserId);

                            if (userid > 0) {
                                window.location.href = "/center.htm";
                            }

                        }
                    }
                });
            }
        }
        return false;
    });

});

function isEmail(email) {
    var test = email.search(/^([-_A-Za-z0-9\.]+)@([_A-Za-z0-9]+\.)+[A-Za-z0-9]{2,3}$/);
    if (test != -1) {
        return true;
    }
    else {
        return false;
    }

}
function isValidUserName(username) {
    var test = username.search(/^[0-9a-zA-Z\\_\u4E00-\u9FA5]+$/);
    if (test != -1) {
        return true;
    }
    else {
        return false;
    }
}

</script>
</head>
<body>
<div id="dialog_resultbox" title="提示信息" style="display: none;">
    <div id="resulttable" style="font-size: 14px;">
    </div>
</div>
<form style="margin: 0;" action="">
    <div class="shell">
        <div id="header">
            <h1 id="logo">
                <a href="#">logourl</a></h1>
        </div>
        <div id="reg_content">
            <div style="margin: 0px auto; width: 75%">
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                        <td height="50" colspan="2" valign="middle">
                            <img src="/images_user/6.gif" />
                        </td>
                    </tr>
                    <tr>
                        <td width="15%" height="50" align="right" class="f14">
                            会员帐号：
                        </td>
                        <td id="td_username" width="85%" valign="middle">
                            <label>
                                <input id="username" name="username" maxlength="40" type="text" class="input1" />
                                <input id="siteid" name="siteid" type="hidden" value="{siteid}" />
                            </label>
                            <span id="span_username_error" class="error_span"></span>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="f14">
                        </td>
                        <td class="b">
                        </td>
                    </tr>
                    <tr>
                        <td height="50" align="right">
                            <span class="f14">密 码：</span>
                        </td>
                        <td id="td_userpass">
                            <input id="userpass" name="userpass" type="password" class="input1" />
                            <span id="span_userpass_error" class="error_span"></span>
                        </td>
                    </tr>
                    <tr>
                        <td align="right">
                        </td>
                        <td class="b">
                            <label class="f12">
                                推荐使用包含数字、字母，和特殊符号的密码，字母区分大小写</label>
                        </td>
                    </tr>
                    <tr>
                        <td height="50" align="right">
                            <span class="f14">确认密码：</span>
                        </td>
                        <td id="td_confirm_userpass">
                            <input id="confirm_userpass" name="confirm_userpass" type="password" class="input1" />
                            <span id="span_confirm_userpass_error" class="error_span"></span>
                        </td>
                    </tr>
                    <tr>
                        <td height="50" align="right">
                            <span class="f14">昵 称：</span>
                        </td>
                        <td id="td_nickname">
                            <input id="nickname" name="nickname" type="text" class="input1" />
                            <span id="span_nickname_error" class="error_span"></span>
                        </td>
                    </tr>
                    <tr>
                        <td height="50" align="right">
                            <span class="f14">真实姓名：</span>
                        </td>
                        <td id="td_realname">
                            <input id="realname" name="realname" type="text" class="input1" />
                            <span id="span_realname_error" class="error_span"></span>
                        </td>
                    </tr>


                    <tr>
                        <td width="15%" height="50" align="right" class="f14">
                            电子邮箱：
                        </td>
                        <td id="td_email" width="85%" valign="middle">
                            <label>
                                <input id="email" name="email" maxlength="40" type="text" class="input1" />
                            </label>
                            <span id="span_email_error" class="error_span"></span>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="f14">
                        </td>
                        <td class="b">
                            <label class="f12">
                                请输入您电子邮箱地址，电子邮箱将会成为您找回密码的一项依据</label>
                        </td>
                    </tr>
                    <tr>
                        <td width="15%" height="50" align="right" class="f14">
                            问题答案：
                        </td>
                        <td id="td2" width="85%" valign="middle">
                            <select id="question" name="question">
                                <option value="您最常用的拍摄器材">您最常用的拍摄器材</option>
                                <option value="您最喜欢的照相机品牌">您的最喜欢的照相机品牌</option>
                                <option value="您拍过最漂亮的地方">您拍过最漂亮的地方</option>
                                <option value="您拍过最漂亮的模特">您拍过最漂亮的模特</option>
                            </select>
                            <label>
                                <input id="answer" name="answer" maxlength="40" type="text" class="input1" />
                            </label>
                            <span id="span_answer_error" class="error_span"></span>
                        </td>
                    </tr>
                    <tr>
                        <td align="right" class="f14">
                        </td>
                        <td class="b">
                            <label class="f12">
                                请输入您问题答案，问题答案将会成为您找回密码的一项依据</label>
                        </td>
                    </tr>
                    <tr>
                        <td height="50" align="right">
                            <span class="f14">验证码：</span>
                        </td>
                        <td>
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td width="100">
                                        <input id="checkcode" name="checkcode" maxlength="4" type="text" class="input1" style="width: 80px;" />
                                    </td>
                                    <td>
                                        <img src="{b_funcdomain}/common/imgcheck.php?sn=userregchecknum" title="" alt="" onclick="this.setAttribute('src','http://func.changsha.cn/common/imgcheck.php?sn=userregchecknum&n='+Math.random());" style="cursor: pointer; height: 30px;" />
                                        点击数字可以刷新
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td>
                        </td>
                        <td height="30" class="f12">
                            <a href="/h/376/sc1.html" target="_blank">确认注册前请阅读《会员注册条款》</a>
                        </td>
                    </tr>
                    <tr>
                        <td>
                        </td>
                        <td height="50" valign="middle">
                            <label>
                                <input name="Submit" type="submit" class="input" value="立即注册" id="btnsubmit" />
                                <span class="orange"><a href="#" target="_blank" class="orange"></a></span>
                            </label>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

</form>
</body>
</html>